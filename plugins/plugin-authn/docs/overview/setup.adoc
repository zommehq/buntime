== Instalação e Configuração

=== Pré-requisitos

* `@buntime/plugin-database` configurado
* Para provedores OAuth: servidor OIDC configurado (Keycloak, Auth0, Okta, etc.)

=== Configuração Básica

IMPORTANT: Cada plugin tem seu próprio `manifest.jsonc` no diretório do plugin. Os plugins são descobertos automaticamente pelo runtime.

==== Email/Password (Desenvolvimento)

A configuração mais simples para desenvolvimento local:

[source,jsonc]
----
// plugins/plugin-database/manifest.jsonc
{
  "enabled": true,
  "adapters": [{ "type": "libsql", "default": true }]
}
----

[source,jsonc]
----
// plugins/plugin-authn/manifest.jsonc
{
  "enabled": true,
  "providers": [
    { "type": "email-password", "allowSignUp": true }
  ]
}
----

==== Keycloak

Para integração com Keycloak:

[source,jsonc]
----
// plugins/plugin-authn/manifest.jsonc
{
  "enabled": true,
  "providers": [
    {
      "type": "keycloak",
      "issuer": "${KEYCLOAK_URL}",
      "realm": "${KEYCLOAK_REALM}",
      "clientId": "${KEYCLOAK_CLIENT_ID}",
      "clientSecret": "${KEYCLOAK_CLIENT_SECRET}"
    }
  ],
  "trustedOrigins": ["http://localhost:8000"]
}
----

NOTE: O campo `issuer` deve ser a URL base do Keycloak (ex: `http://localhost:8180/auth`), sem incluir `/realms/{realm}`. O plugin automaticamente constrói a URL completa do issuer OIDC combinando o issuer com o realm configurado.

==== Auth0

[source,jsonc]
----
// plugins/plugin-authn/manifest.jsonc
{
  "enabled": true,
  "providers": [
    {
      "type": "auth0",
      "domain": "${AUTH0_DOMAIN}",
      "clientId": "${AUTH0_CLIENT_ID}",
      "clientSecret": "${AUTH0_CLIENT_SECRET}"
    }
  ]
}
----

==== Okta

[source,jsonc]
----
// plugins/plugin-authn/manifest.jsonc
{
  "enabled": true,
  "providers": [
    {
      "type": "okta",
      "domain": "${OKTA_DOMAIN}",
      "clientId": "${OKTA_CLIENT_ID}",
      "clientSecret": "${OKTA_CLIENT_SECRET}"
    }
  ]
}
----

==== OIDC Genérico

Para qualquer provedor OIDC compatível:

[source,jsonc]
----
// plugins/plugin-authn/manifest.jsonc
{
  "enabled": true,
  "providers": [
    {
      "type": "generic-oidc",
      "issuer": "${OIDC_ISSUER}",
      "clientId": "${OIDC_CLIENT_ID}",
      "clientSecret": "${OIDC_CLIENT_SECRET}",
      "displayName": "My OIDC Provider"
    }
  ]
}
----

==== Múltiplos Provedores

Combine múltiplos provedores na mesma aplicação:

[source,jsonc]
----
// plugins/plugin-authn/manifest.jsonc
{
  "enabled": true,
  "providers": [
    { "type": "email-password", "allowSignUp": true },
    {
      "type": "keycloak",
      "issuer": "${KEYCLOAK_URL}",
      "realm": "${KEYCLOAK_REALM}",
      "clientId": "${KEYCLOAK_CLIENT_ID}",
      "clientSecret": "${KEYCLOAK_CLIENT_SECRET}"
    }
  ]
}
----

=== Variáveis de Ambiente

Crie ou edite o arquivo `.env` no diretório do runtime:

[source,bash]
----
# Keycloak
KEYCLOAK_URL=http://localhost:8180/auth
KEYCLOAK_REALM=buntime
KEYCLOAK_CLIENT_ID=buntime-app
KEYCLOAK_CLIENT_SECRET=seu-client-secret

# Auth0
AUTH0_DOMAIN=your-tenant.auth0.com
AUTH0_CLIENT_ID=your-client-id
AUTH0_CLIENT_SECRET=your-client-secret

# Okta
OKTA_DOMAIN=your-domain.okta.com
OKTA_CLIENT_ID=your-client-id
OKTA_CLIENT_SECRET=your-client-secret
----

=== Configuração do Keycloak

==== Criar Realm

. Acesse o Keycloak Admin Console (ex: `http://localhost:8180/auth`)
. Login com admin/admin
. Crie um novo realm (ex: `buntime`)

==== Criar Client

. No realm, vá em Clients > Create client
. Configure:
** Client ID: `buntime-app`
** Client type: `OpenID Connect`
** Client authentication: `On` (confidential)
. Em Settings, configure:
** Valid redirect URIs: `http://localhost:8000/*`
** Web origins: `http://localhost:8000`
. Em Credentials, copie o Client Secret

==== Criar Usuário (opcional)

. Vá em Users > Add user
. Preencha username e email
. Em Credentials, defina uma senha

=== Verificação

Após iniciar o Buntime:

. Acesse `http://localhost:8000` - deve redirecionar para login
. Acesse `http://localhost:8000/auth/login` - página de login
. Selecione o provedor desejado
. Após autenticação, será redirecionado de volta
