# CPanel (Admin Dashboard)

## Overview

CPanel is a React-based admin dashboard for managing Buntime worker pool deployments. It provides:

**Dashboard Features:**
- Real-time pool metrics visualization (workers, requests/sec, latency, cache hit rate)
- Worker list with status and statistics
- Metrics charts with historical data

**Deployment Management:**
- File browser for app deployments
- Upload, rename, and delete files/folders
- Create new folders and versions

**Redirect/Proxy Management:**
- CRUD for proxy rules
- Pattern matching with regex
- Path rewriting configuration

**Internationalization:**
- Multi-language support (English, Portuguese)
- Dynamic namespace loading

## Tech Stack

- Bun runtime + Bun.serve()
- React 19
- TanStack Router (file-based routing)
- TanStack Query (data fetching)
- TanStack Table (data tables)
- Tailwind CSS v4
- Radix UI primitives
- shadcn/ui components
- i18next (internationalization)
- Recharts (charts)

## Project Structure

```
apps/cpanel/
├── index.ts                  # Production entry (Bun.serve)
├── index.dev.ts              # Development entry with HMR
├── bunfig.toml               # Bun configuration (plugins, preload)
├── tsconfig.json             # TypeScript config
├── package.json              # Dependencies and scripts
├── components.json           # shadcn/ui config
├── scripts/
│   ├── build.ts              # Production build script
│   └── preload.ts            # TSR plugin preload
└── src/
    ├── index.html            # HTML entry point
    ├── index.tsx             # React app entry
    ├── index.css             # Global styles (Tailwind)
    ├── constants.ts          # Environment variables
    ├── components/
    │   ├── icon.tsx          # Icon component (virtual:icons)
    │   ├── crud-layout.tsx   # CRUD page layout
    │   ├── navigation/       # Sidebar navigation
    │   └── ui/               # shadcn/ui components
    ├── contexts/
    │   └── header-context.tsx # Header action context
    ├── helpers/
    │   ├── api-client.ts     # Hono RPC client
    │   ├── i18n.ts           # i18next setup
    │   └── query-client.ts   # TanStack Query client
    ├── hooks/
    │   ├── use-debounce.ts
    │   ├── use-mobile.ts
    │   ├── use-pool-stats.ts # SSE pool metrics
    │   └── use-query-state.ts # URL query params
    ├── routes/               # TanStack Router (file-based)
    │   ├── __root.tsx        # Root layout
    │   ├── index.tsx         # Dashboard page
    │   ├── deployments/
    │   │   ├── index.tsx     # File browser
    │   │   └── -components/  # Route-specific components
    │   └── redirects/
    │       ├── index.tsx     # Proxy rules
    │       └── -components/
    ├── types/
    │   └── icons.d.ts        # virtual:icons types
    └── locales/              # i18n translations
        ├── en/
        └── pt/
```

## Routes

| Route | Description |
|-------|-------------|
| `/` | Dashboard with pool overview and metrics |
| `/deployments` | File browser for app deployments |
| `/redirects` | Proxy rules management |

## API Proxy

The admin dashboard proxies API requests to the Buntime backend:

```typescript
// index.ts
routes: {
  "/_/*": proxyTo(BUNTIME_API),  // Proxy to backend
  "/*": client,                   // Serve React SPA
}
```

- `/_/*` routes are proxied to Buntime backend (default: port 8080)
- All other routes serve the React SPA

## Scripts

```bash
bun dev          # Start dev server with HMR
bun build        # Build for production
bun lint         # Format + type check
bun lint:types   # Type check with TypeScript
```

## Path Aliases

- `~/` maps to `./src/`

**Usage:**
```typescript
import { Button } from "~/components/ui/button";
import { api } from "~/helpers/api-client";
```

## Key Components

### Icon Component

Uses `virtual:icons` registry generated by iconify plugin:

```tsx
import { Icon } from "~/components/icon";

<Icon icon="lucide:search" className="size-4" />
```

### API Client

Hono RPC client for type-safe API calls:

```typescript
import { api } from "~/helpers/api-client";

const res = await api._.deployments.list.$get({ query: { path } });
const json = await res.json();
```

## Routing

TanStack Router with file-based routing:

| File | Route |
|------|-------|
| `routes/__root.tsx` | Root layout (sidebar, header) |
| `routes/index.tsx` | `/` - Dashboard |
| `routes/deployments/index.tsx` | `/deployments` - File browser |
| `routes/redirects/index.tsx` | `/redirects` - Proxy rules |

Files in `-components/` folders are NOT routes - they are route-specific components.

