== Project Endpoints
:order: 1

=== Endpoint Overview

[mermaid]
----
flowchart LR
    Root[/api/projects]
    Project[/:project]
    Tree[/tree]
    Overview[/overview]
    Docs[/docs/*]
    Releases[/releases/*]
    Files[/files/*]

    Root -->|GET| ListProjects[List All Projects]
    Project -->|GET| ProjectInfo[Get Project Info]
    Project --> Tree
    Project --> Overview
    Project --> Docs
    Project --> Releases
    Project --> Files

    Tree -->|GET + ?lang| TreeStructure[Get File Tree]
    Overview -->|GET + ?lang| ProjectOverview[Get index.adoc]
    Docs -->|GET + ?lang| DocBySlug[Get Doc by Slug]
    Releases -->|GET + ?lang| ReleasesList[Get Releases Timeline]
    Files -->|GET + ?lang| FileContent[Get File Content]

    style Root fill:#4A90E2
    style ListProjects fill:#7ED321
    style ProjectInfo fill:#7ED321
    style TreeStructure fill:#7ED321
    style ProjectOverview fill:#7ED321
    style DocBySlug fill:#7ED321
    style ReleasesList fill:#7ED321
    style FileContent fill:#F5A623
----

=== List Projects

Lists all configured projects by scanning the content directory.

[source,http]
----
GET /api/projects
----

**Flow:**

[mermaid]
----
sequenceDiagram
    participant C as Client
    participant A as API
    participant F as File System

    C->>A: GET /api/projects
    A->>F: Read content/ directory
    F-->>A: List of project folders
    loop For each project folder
        A->>F: Check for index.adoc or project.json
        F-->>A: Project config
    end
    A-->>C: JSON array of projects
----

**Response:**

[source,json]
----
[
  {
    "name": "leaf",
    "title": "Leaf Documentation",
    "description": "Official documentation for Leaf",
    "icon": "lucide:book",
    "repo": "https://github.com/org/leaf"
  },
  {
    "name": "my-project",
    "title": "My Project"
  }
]
----

=== Get Project Info

Returns detailed information about a specific project including available languages.

[source,http]
----
GET /api/projects/:project
----

**Parameters:**

* `project` - Project name (e.g., `leaf`)

**Flow:**

[mermaid]
----
sequenceDiagram
    participant C as Client
    participant A as API
    participant F as File System

    C->>A: GET /api/projects/leaf
    A->>F: Load project config
    F-->>A: Config from index.adoc
    loop For each supported language
        A->>F: Check language folder exists
        F-->>A: Boolean
    end
    A-->>C: Project info + available languages
----

**Response:**

[source,json]
----
{
  "name": "leaf",
  "title": "Leaf Documentation",
  "description": "Official documentation",
  "icon": "lucide:book",
  "repo": "https://github.com/org/leaf",
  "languages": ["en", "pt", "es"]
}
----

=== Get File Tree

Returns the hierarchical structure of documentation files for a project.

[source,http]
----
GET /api/projects/:project/tree?lang=en
----

**Parameters:**

* `project` - Project name
* `lang` - Language code (optional, defaults to `en`)

**Flow:**

[mermaid]
----
sequenceDiagram
    participant C as Client
    participant A as API
    participant L as Language Resolver
    participant F as File System
    participant P as Parser

    C->>A: GET /api/projects/leaf/tree?lang=pt
    A->>F: Check project exists
    F-->>A: Confirmed
    A->>L: Resolve language
    L->>F: Check pt/ folder
    alt Folder exists
        L-->>A: Use pt
    else Fallback
        L-->>A: Use en
    end
    A->>F: Scan language directory
    F-->>A: List of .adoc files
    loop For each file
        A->>P: Parse :order: and :title:
        P-->>A: Metadata
    end
    A->>A: Build hierarchical tree
    A-->>C: Tree structure
----

**Response:**

[source,json]
----
{
  "lang": "pt",
  "tree": [
    {
      "name": "Getting Started",
      "path": "getting-started",
      "order": 1,
      "children": [
        {
          "name": "Installation",
          "path": "getting-started/installation.adoc",
          "order": 1,
          "slug": "getting-started/installation"
        }
      ]
    },
    {
      "name": "API",
      "path": "api",
      "order": 4,
      "children": []
    }
  ]
}
----

=== Get Project Overview

Returns the main index.adoc file for a project (project homepage).

[source,http]
----
GET /api/projects/:project/overview?lang=en
----

**Parameters:**

* `project` - Project name
* `lang` - Language code (optional)

**Response:**

[source,json]
----
{
  "html": "<div class='content'>...</div>",
  "lang": "en",
  "modifiedAt": "2025-12-20T10:30:00Z",
  "path": "index.adoc"
}
----

=== Get Document by Slug

Returns a specific document using its slug (SEO-friendly URL path).

[source,http]
----
GET /api/projects/:project/docs/:slug?lang=en
----

**Parameters:**

* `project` - Project name
* `slug` - Document slug (e.g., `getting-started/installation`)
* `lang` - Language code (optional)

**Flow:**

[mermaid]
----
sequenceDiagram
    participant C as Client
    participant A as API
    participant M as Slug Mapper
    participant P as Parser
    participant F as File System

    C->>A: GET /api/projects/leaf/docs/api/projects?lang=en
    A->>F: Build tree for language
    F-->>A: Tree structure
    A->>M: Build slug map
    M-->>A: Map of slug â†’ file path
    A->>M: Resolve slug "api/projects"
    M-->>A: File path "api/projects.adoc"
    A->>F: Security check (path within content/)
    F-->>A: Valid
    A->>F: Read file content
    F-->>A: AsciiDoc content
    A->>P: Parse AsciiDoc to HTML
    P-->>A: HTML + metadata
    A-->>C: JSON response
----

**Response:**

[source,json]
----
{
  "html": "<h2>Project Endpoints</h2>...",
  "lang": "en",
  "modifiedAt": "2025-12-20T10:30:00Z",
  "path": "api/projects.adoc",
  "slug": "api/projects"
}
----

**Response with Timeline:**

If the document has a `:timeline:` attribute:

[source,json]
----
{
  "html": "<h2>Release Notes</h2>...",
  "lang": "en",
  "modifiedAt": "2025-12-20T10:30:00Z",
  "path": "releases/index.adoc",
  "slug": "releases",
  "timelineFolder": "releases"
}
----

=== Get Releases Timeline

Returns a chronologically sorted list of releases from a folder.

[source,http]
----
GET /api/projects/:project/releases/:folder?lang=en
----

**Parameters:**

* `project` - Project name
* `folder` - Folder path (optional, defaults to `releases`)
* `lang` - Language code (optional)

**Flow:**

[mermaid]
----
sequenceDiagram
    participant C as Client
    participant A as API
    participant F as File System
    participant P as Parser

    C->>A: GET /api/projects/leaf/releases/releases?lang=en
    A->>F: Check releases folder exists
    F-->>A: Confirmed
    A->>F: Read all .adoc files (except index.adoc)
    F-->>A: List of files
    loop For each file
        A->>P: Parse :release-date:, :title:, :release-summary:
        P-->>A: Release metadata
        alt Has release-date
            A->>A: Add to releases list
        end
    end
    A->>A: Sort by date descending
    A-->>C: Releases array
----

**Response:**

[source,json]
----
{
  "lang": "en",
  "releases": [
    {
      "date": "2025-12-15",
      "name": "Version 1.2.0",
      "slug": "releases/v1-2-0",
      "summary": "Added timeline support and i18n improvements"
    },
    {
      "date": "2025-12-01",
      "name": "Version 1.1.0",
      "slug": "releases/v1-1-0",
      "summary": "Performance improvements"
    }
  ]
}
----
