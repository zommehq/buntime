== Variables de Entorno
:order: 1

=== Flujo de Entorno

[mermaid]
----
flowchart LR
    subgraph "Configuración de Entorno"
        E1[Definir GITLAB_URL]
        E2[Definir GITLAB_TOKEN]
        E3[Definir BUNTIME_URL]
    end

    subgraph "Inicialización de la Aplicación"
        A[Leaf inicia]
        A --> V[Validar config]
        V --> C{Todas las vars obligatorias definidas?}
    end

    subgraph "Runtime"
        R[Servidor listo]
        R --> API[Endpoints API activos]
        API --> GL[Integración GitLab]
    end

    E1 --> A
    E2 --> A
    E3 --> A
    C -->|Sí| R
    C -->|No| ERR[Error: Config faltante]

    style E1 fill:#e1f5ff
    style E2 fill:#e1f5ff
    style E3 fill:#e1f5ff
    style R fill:#d4edda
    style ERR fill:#f8d7da
----

=== Configuración

[cols="2,1,2,2"]
|===
| Variable | Tipo | Default | Descripción

| `GITLAB_URL`
| string
| `https://gitlab.cloud4biz.com`
| URL base de la instancia GitLab

| `GITLAB_TOKEN`
| string
| (vacío)
| Token de acceso personal o de proyecto

| `BUNTIME_URL`
| string
| `http://localhost:8000`
| URL interna de buntime (para llamadas server-side)
|===

=== Ejemplo

[source,bash]
----
# Desarrollo local
export GITLAB_URL=https://gitlab.cloud4biz.com
export GITLAB_TOKEN=glpat-xxxxxxxxxxxxxxxxxxxx

# Producción
export GITLAB_URL=https://gitlab.cloud4biz.com
export GITLAB_TOKEN=${GITLAB_TOKEN_SECRET}
----

=== Seguridad

IMPORTANT: Nunca haga commit de tokens en el código. Use variables de entorno o secrets management.

==== Permisos Mínimos

El token necesita solamente:

* `read_repository` - Para leer archivos de los repositorios

==== Buenas Prácticas

* Use tokens de proyecto cuando sea posible (alcance limitado)
* Configure expiración del token
* Rote tokens periódicamente
* Use secrets management en producción (Vault, K8s Secrets, etc)
