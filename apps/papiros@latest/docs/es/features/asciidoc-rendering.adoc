== Renderización AsciiDoc
:order: 2

=== Cómo Funciona

La aplicación usa la biblioteca `asciidoctor.js` para convertir AsciiDoc en HTML directamente en el navegador.

=== Pipeline de Renderización

[mermaid]
----
flowchart LR
    User[User Request] --> API[API Route]
    API --> FileSystem[Read .adoc File]
    FileSystem --> Asciidoctor[Asciidoctor.js]
    Asciidoctor --> RawHTML[Raw HTML]
    RawHTML --> Response[API Response]

    Response --> Browser[Browser]
    Browser --> DocViewer[DocViewer Component]

    DocViewer --> Process[HTML Processing]
    Process --> FixAnchors[Fix Anchor Links]
    Process --> FixDocLinks[Fix Doc Links]

    FixAnchors --> ProcessedHTML[Processed HTML]
    FixDocLinks --> ProcessedHTML

    ProcessedHTML --> Render[Render HTML Content]
    ProcessedHTML --> ExtractTOC[Extract TOC Items]

    Render --> Display[Display Article]
    ExtractTOC --> TocAside[TocAside Component]

    style Asciidoctor fill:#ff9999
    style Process fill:#99ccff
    style DocViewer fill:#fff4e1
----

[source,typescript]
----
import Asciidoctor from "asciidoctor";

const asciidoctor = Asciidoctor();

const html = asciidoctor.convert(content, {
  safe: "safe",
  attributes: {
    showtitle: true,
    icons: "font",
    sectanchors: true,
    toc: "auto",
  },
});
----

=== Atributos Soportados

[cols="2,3"]
|===
| Atributo | Descripción

| `showtitle`
| Muestra el título del documento

| `icons: font`
| Usa Font Awesome para iconos

| `sectanchors`
| Agrega anclas a las secciones

| `sectlinks`
| Transforma títulos en enlaces

| `toc: auto`
| Genera Table of Contents

| `toclevels: 3`
| Niveles de profundidad del TOC

| `source-highlighter`
| Syntax highlighting para bloques de código
|===

=== Estilos CSS

La aplicación incluye estilos personalizados para el contenido renderizado:

* Tablas con bordes y zebra striping
* Bloques de código con fondo oscuro
* Admonitions coloreados (NOTE, TIP, WARNING, etc)
* Enlaces estilizados
* Listas con espaciado adecuado

=== Procesamiento de Enlaces

El componente DocViewer transforma enlaces de dos maneras:

[mermaid]
----
flowchart TD
    HTML[Raw HTML from API]

    HTML --> CheckAnchor{Anchor Link?}
    CheckAnchor -->|Yes| FixAnchor[Fix: href=#section<br/>becomes<br/>href=/project/file#section]
    CheckAnchor -->|No| CheckDoc{.adoc Link?}

    CheckDoc -->|Yes| FixDoc[Fix: href=file.adoc<br/>becomes<br/>href=/project/file<br/>+ data-doc-link attribute]
    CheckDoc -->|No| Keep[Keep Original]

    FixAnchor --> Final[Processed HTML]
    FixDoc --> Final
    Keep --> Final

    Final --> Intercept[Click Event Listener]
    Intercept --> SPANav{Has data-doc-link?}
    SPANav -->|Yes| RouterPush[router.history.push]
    SPANav -->|No| NormalNav[Normal Navigation]

    style FixAnchor fill:#99ff99
    style FixDoc fill:#99ccff
    style RouterPush fill:#ffcc99
----

=== Limitaciones Actuales

* Las directivas `include::` no son procesadas (archivos incluidos no son buscados)
* Las imágenes necesitan URL absoluta
* Diagramas Mermaid/PlantUML no son renderizados
* Cross-references entre documentos no funcionan
