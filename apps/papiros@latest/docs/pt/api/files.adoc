== Endpoints de Arquivos
:order: 2

=== Buscar Arquivo Específico (Legado)

WARNING: Este endpoint é mantido para compatibilidade retroativa. Use `/api/projects/:project/docs/:slug` para novas implementações.

Retorna o conteúdo bruto de um arquivo .adoc específico por caminho direto.

[source,http]
----
GET /api/projects/:project/files/:path?lang=pt
----

**Parâmetros:**

* `project` - Nome do projeto
* `path` - Caminho do arquivo relativo à pasta de idioma (ex: `api/projects.adoc`)
* `lang` - Código do idioma (opcional, padrão é `en`)

**Fluxo:**

[mermaid]
----
sequenceDiagram
    participant C as Client
    participant A as API
    participant S as Security Check
    participant F as File System
    participant P as Parser

    C->>A: GET /api/projects/leaf/files/api/projects.adoc?lang=pt
    A->>A: Build full path: content/leaf/pt/api/projects.adoc
    A->>S: Validate path within content/
    alt Path invalid
        S-->>A: Security violation
        A-->>C: 400 Bad Request
    else Path valid
        S-->>A: Valid
        A->>F: Read file
        alt File not found
            F-->>A: Error
            A-->>C: 404 Not Found
        else File exists
            F-->>A: AsciiDoc content
            A->>P: Convert to HTML
            P-->>A: HTML + metadata
            A-->>C: JSON response
        end
    end
----

**Exemplo:**

[source,bash]
----
curl "http://localhost:3000/api/projects/leaf/files/api/projects.adoc?lang=pt"
----

**Resposta:**

[source,json]
----
{
  "html": "<h2>Endpoints de Projetos</h2>...",
  "lang": "pt",
  "modifiedAt": "2025-12-20T10:30:00Z",
  "path": "api/projects.adoc"
}
----

=== Segurança

O endpoint de arquivos inclui medidas de segurança para prevenir ataques de travessia de caminho:

[mermaid]
----
flowchart TD
    Request[File Request]
    BuildPath[Build Full Path]
    Check{Path starts with<br/>CONTENT_DIR?}
    Valid[Read File]
    Invalid[Return 400 Error]

    Request --> BuildPath
    BuildPath --> Check
    Check -->|Yes| Valid
    Check -->|No| Invalid

    style Invalid fill:#E74C3C
    style Valid fill:#7ED321
----

**Protegido contra:**

* Travessia de caminho: `../../../etc/passwd`
* Caminhos absolutos: `/etc/passwd`
* Exploração de links simbólicos

=== Erros Comuns

[cols="1,2,3"]
|===
| Código | Erro | Causa

| 400
| Invalid path
| Tentativa de travessia de caminho ou caminho fora do diretório de conteúdo

| 404
| File not found
| Arquivo não existe no caminho especificado

| 404
| No documentation available
| Pasta de idioma não existe para o projeto
|===

=== Guia de Migração

Migre do endpoint legado `/files/` para o endpoint moderno `/docs/`:

[cols="2,2"]
|===
| Legado (files) | Moderno (docs com slug)

| `/api/projects/leaf/files/api/projects.adoc`
| `/api/projects/leaf/docs/api/projects`

| Caminho de arquivo direto obrigatório
| Slug amigável para SEO

| Sem mapeamento de slug
| Resolução automática de slug

| Construção manual de caminho
| Navegação hierárquica em árvore
|===

**Benefícios do endpoint `/docs/`:**

* URLs amigáveis para SEO
* Mapeamento automático de slug
* Suporte para slugs personalizados via atributo `:slug:`
* Melhor segurança através de validação de slug
* Detecção de pasta de timeline
