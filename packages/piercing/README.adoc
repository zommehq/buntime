= Piercing
:toc: left
:toclevels: 3
:sectnums:
:sectnumlevels: 5
:icons: font
:source-highlighter: highlightjs

ifdef::env-github[]
:tip-caption: üí°
:note-caption: ‚ÑπÔ∏è
:important-caption: ‚ö†Ô∏è
:caution-caption: üî•
:warning-caption: ‚ö†Ô∏è
endif::[]

toc::[]

== Introdu√ß√£o

Piercing √© um framework de micro-frontends com suporte completo a SSR (Server-Side Rendering), permitindo compor fragmentos de interface de m√∫ltiplas aplica√ß√µes em uma √∫nica p√°gina com hidrata√ß√£o progressiva e comunica√ß√£o em tempo real.

=== O que √© Piercing?

Piercing permite que voc√™:

* **Componha fragmentos SSR** - Integre m√∫ltiplos fragmentos renderizados no servidor em uma √∫nica resposta HTML
* **Compartilhe estado** - Use MessageBus isom√≥rfico para comunica√ß√£o entre fragmentos (cliente e servidor)
* **Hidrata√ß√£o progressiva** - Fragmentos s√£o pr√©-renderizados no servidor e hidratados progressivamente no cliente
* **Isolamento seguro** - Suporte a m√∫ltiplas estrat√©gias de sandbox (none, monkey-patch, iframe, service-worker)

[source,typescript]
----
import { PiercingGateway } from "@buntime/piercing";

const gateway = new PiercingGateway({
  getShellHtml: async (request) => shellHtml,
  generateMessageBusState: async (state, request) => ({
    ...state,
    user: { id: 1, name: "Alice" },
  }),
});

gateway.registerFragment({
  fragmentId: "header",
  fetchFragment: async (request) => headerApp.fetch(request),
  prePierceRoutes: ["/"],
});

gateway.registerFragment({
  fragmentId: "sidebar",
  fetchFragment: async (request) => sidebarApp.fetch(request),
  framework: "react",
});

// Handle request
const response = await gateway.handleRequest(request);
----

=== Quando usar Piercing?

[cols="1,1"]
|===
| Bom para: | Evitar para:

| Micro-frontends com SSR
| Aplica√ß√µes monol√≠ticas simples

| Composi√ß√£o de equipes independentes
| Projetos com √∫nica equipe

| Migra√ß√£o gradual de sistemas legados
| Greenfield sem necessidade de isolamento

| Reutiliza√ß√£o de componentes entre apps
| Componentes compartilhados via biblioteca

| A/B testing e feature flags por fragmento
| A/B testing simples no cliente

| Isolamento de depend√™ncias
| Depend√™ncias unificadas
|===

== Arquitetura

Vis√£o geral da arquitetura do Piercing.

include::docs/architecture/overview.adoc[leveloffset=+1]

include::docs/architecture/ssr-flow.adoc[leveloffset=+1]

include::docs/architecture/hydration.adoc[leveloffset=+1]

== Gateway

O PiercingGateway √© respons√°vel por compor fragmentos SSR em uma √∫nica resposta HTML.

include::docs/gateway/configuration.adoc[leveloffset=+1]

include::docs/gateway/fragments.adoc[leveloffset=+1]

include::docs/gateway/streaming.adoc[leveloffset=+1]

include::docs/gateway/shell.adoc[leveloffset=+1]

== MessageBus

Sistema isom√≥rfico de comunica√ß√£o entre fragmentos.

include::docs/message-bus/introduction.adoc[leveloffset=+1]

include::docs/message-bus/server-side.adoc[leveloffset=+1]

include::docs/message-bus/client-side.adoc[leveloffset=+1]

include::docs/message-bus/state-transfer.adoc[leveloffset=+1]

== Client SDK

SDK para desenvolver fragmentos que rodam no Piercing.

include::docs/client/fragment-client.adoc[leveloffset=+1]

include::docs/client/fragment-host.adoc[leveloffset=+1]

include::docs/client/hooks.adoc[leveloffset=+1]

include::docs/client/web-components.adoc[leveloffset=+1]

== Sandbox

Estrat√©gias de isolamento para execu√ß√£o segura de fragmentos.

include::docs/sandbox/strategies.adoc[leveloffset=+1]

include::docs/sandbox/none.adoc[leveloffset=+1]

include::docs/sandbox/monkey-patch.adoc[leveloffset=+1]

include::docs/sandbox/iframe.adoc[leveloffset=+1]

include::docs/sandbox/service-worker.adoc[leveloffset=+1]

== Frameworks

Integra√ß√£o com frameworks populares.

include::docs/frameworks/react.adoc[leveloffset=+1]

include::docs/frameworks/qwik.adoc[leveloffset=+1]

include::docs/frameworks/solid.adoc[leveloffset=+1]

include::docs/frameworks/vue.adoc[leveloffset=+1]

== Exemplos

Casos de uso pr√°ticos e patterns recomendados.

include::docs/examples/basic-composition.adoc[leveloffset=+1]

include::docs/examples/auth-integration.adoc[leveloffset=+1]

include::docs/examples/feature-flags.adoc[leveloffset=+1]

include::docs/examples/ab-testing.adoc[leveloffset=+1]

include::docs/examples/navigation.adoc[leveloffset=+1]

== Refer√™ncia de API

include::docs/api/piercing-gateway.adoc[leveloffset=+1]

include::docs/api/message-bus.adoc[leveloffset=+1]

include::docs/api/fragment-client.adoc[leveloffset=+1]

include::docs/api/sandbox.adoc[leveloffset=+1]

include::docs/api/stream-utils.adoc[leveloffset=+1]

== Limita√ß√µes

include::docs/limitations.adoc[leveloffset=+1]
