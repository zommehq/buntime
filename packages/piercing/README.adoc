= Piercing
:toc: left
:toclevels: 3
:sectnums:
:sectnumlevels: 5
:icons: font
:source-highlighter: highlightjs

ifdef::env-github[]
:tip-caption: üí°
:note-caption: ‚ÑπÔ∏è
:important-caption: ‚ö†Ô∏è
:caution-caption: üî•
:warning-caption: ‚ö†Ô∏è
endif::[]

toc::[]

== Introdu√ß√£o

Piercing √© um framework client-side para micro-frontends, permitindo compor fragmentos de interface de m√∫ltiplas aplica√ß√µes em uma √∫nica p√°gina com streaming HTML e comunica√ß√£o em tempo real.

NOTE: Server-side pre-piercing √© fornecido pelo `@buntime/plugin-piercing`. Este pacote cont√©m apenas o c√≥digo client-side.

=== O que √© Piercing?

Piercing permite que voc√™:

* **Componha fragmentos** - Integre m√∫ltiplos fragmentos em uma √∫nica p√°gina usando web components
* **Streaming HTML** - Fragmentos s√£o carregados via streaming usando `writable-dom`
* **Compartilhe estado** - Use MessageBus para comunica√ß√£o entre fragmentos
* **Isolamento de CSS** - Shadow DOM isola estilos entre shell e fragmentos
* **Isolamento de hist√≥rico** - Estrat√©gias `patch` e `isolate` para navega√ß√£o

=== Uso B√°sico

[source,html]
----
<!-- No shell HTML -->
<fragment-outlet src="/metrics" base="/cpanel"></fragment-outlet>
<fragment-outlet src="/health" base="/cpanel"></fragment-outlet>
----

[source,typescript]
----
// No entry point do shell
import { registerPiercingComponents } from "@buntime/piercing/client";

registerPiercingComponents();
----

=== Quando usar Piercing?

[cols="1,1"]
|===
| Bom para: | Evitar para:

| Micro-frontends compostos
| Aplica√ß√µes monol√≠ticas simples

| Composi√ß√£o de equipes independentes
| Projetos com √∫nica equipe

| Plugins com UI independente
| Componentes compartilhados via biblioteca

| Isolamento de CSS/JavaScript
| Aplica√ß√µes com estilo unificado
|===

== Web Components

Os web components s√£o a base do Piercing no cliente.

include::docs/client/web-components.adoc[leveloffset=+1]

include::docs/client/fragment-host.adoc[leveloffset=+1]

== MessageBus

Sistema de comunica√ß√£o entre fragmentos.

include::docs/message-bus/client.adoc[leveloffset=+1]

== Sandbox

Estrat√©gias de isolamento para execu√ß√£o de fragmentos.

include::docs/sandbox/strategies.adoc[leveloffset=+1]

== Pre-Piercing (Server-Side)

Server-side pre-piercing √© fornecido pelo plugin `@buntime/plugin-piercing`.

include::docs/gateway/pre-piercing.adoc[leveloffset=+1]

== Exemplos

include::docs/examples/basic-setup.adoc[leveloffset=+1]

== API Reference

=== Web Components

==== fragment-outlet

Placeholder que carrega e renderiza um fragmento.

[cols="1,1,3"]
|===
| Atributo | Tipo | Descri√ß√£o

| `src`
| string (required)
| URL para buscar o fragmento

| `base`
| string
| Base path do shell para contexto de roteamento

| `history`
| "patch" \| "isolate"
| Estrat√©gia de isolamento de hist√≥rico
|===

==== fragment-host

Container para conte√∫do do fragmento (usado internamente e no pre-piercing).

[cols="1,1,3"]
|===
| Atributo | Tipo | Descri√ß√£o

| `src`
| string (required)
| URL do fragmento (mesmo valor do outlet)
|===

=== MessageBus

[source,typescript]
----
import { getBus, dispatch, subscribe } from "@buntime/piercing/client";

// Obter inst√¢ncia do bus
const bus = getBus();

// Dispatch evento
dispatch("user:login", { id: 1, name: "Alice" });

// Subscribe a evento
const unsubscribe = subscribe("user:login", (user) => {
  console.log("User logged in:", user);
});

// Cleanup
unsubscribe();
----

=== Types

[source,typescript]
----
import type {
  JSONValue,
  MessageBus,
  MessageBusCallback,
  MessageBusState,
  NavigationItem,
} from "@buntime/piercing";
----
